-- Domain definitions for KOAssistant
-- Domains provide background knowledge context for AI conversations
--
-- Each domain has:
--   name: Display name shown in UI
--   context: Background knowledge text prepended to messages (keep concise for token efficiency)
--   system_hint: Optional hint added to system prompt when this domain is active
--
-- To add custom domains, create domains in your configuration.lua file:
--   domains = { my_domain = { name = "My Domain", context = "..." } }
--
-- Token cost note: Domain context is added to every message, increasing API costs.
-- Keep context text concise (200-500 tokens recommended) and focused on key concepts.

local _ = require("gettext")

local Domains = {
    -- Sample domains - customize or add your own in configuration.lua

    research = {
        name = _("Research"),
        context = [[This conversation relates to academic research and analysis.
Focus on critical thinking, source evaluation, methodology, and evidence-based reasoning.
When discussing claims, consider the strength of evidence and potential biases.]],
        system_hint = _("Approach topics with academic rigor and cite sources when possible."),
    },

    language_learning = {
        name = _("Language Learning"),
        context = [[This conversation relates to language learning and linguistics.
Consider vocabulary, grammar, usage patterns, etymology, and practical communication.
Explain linguistic concepts clearly and provide examples when helpful.]],
        system_hint = _("Provide clear explanations with examples, and note common mistakes learners make."),
    },

    literature = {
        name = _("Literature"),
        context = [[This conversation relates to literary analysis and discussion.
Consider themes, symbolism, narrative techniques, historical context, and author intent.
Apply appropriate literary criticism frameworks when analyzing texts.]],
        system_hint = _("Analyze texts thoughtfully, considering both form and content."),
    },

    philosophy = {
        name = _("Philosophy"),
        context = [[This conversation relates to philosophical inquiry and analysis.
Consider different philosophical traditions, logical argumentation, and conceptual clarity.
Engage with ideas rigorously while remaining accessible.]],
        system_hint = _("Engage with ideas carefully, distinguishing between different philosophical positions."),
    },

    history = {
        name = _("History"),
        context = [[This conversation relates to historical analysis and understanding.
Consider primary sources, historiographical debates, and multiple perspectives on events.
Place events in their proper temporal and cultural context.]],
        system_hint = _("Provide historical context and note when interpretations are contested."),
    },
}

-- Merge with user-defined domains from configuration.lua if available
local function loadDomains()
    local domains = {}

    -- Copy built-in domains
    for id, domain in pairs(Domains) do
        domains[id] = domain
    end

    -- Try to load user domains from configuration.lua
    local success, config = pcall(function() return require("configuration") end)
    if success and config and config.domains then
        for id, domain in pairs(config.domains) do
            domains[id] = domain
        end
    end

    return domains
end

-- Get sorted list of domain IDs for UI
local function getSortedDomainIds(domains)
    local ids = {}
    for id in pairs(domains) do
        table.insert(ids, id)
    end
    table.sort(ids, function(a, b)
        return (domains[a].name or a) < (domains[b].name or b)
    end)
    return ids
end

return {
    builtin = Domains,
    load = loadDomains,
    getSortedIds = getSortedDomainIds,
}
